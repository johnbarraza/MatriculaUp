---
phase: 6
plan: 1
wave: 1
depends_on: ["Phase 5"]
files_modified: ["matriculaup_app/lib/ui/pages/home_page.dart", "matriculaup_app/lib/ui/components/course_search_list.dart", "matriculaup_app/lib/ui/components/timetable_grid.dart"]
autonomous: false
must_haves:
  truths:
    - "The user sees a side-by-side layout: course search on the left, timetable grid on the right."
    - "The user can expand a course to see its sections and click to add a section to their schedule."
    - "Added sections appear as colored blocks on the timetable grid."
  artifacts:
    - "matriculaup_app/lib/ui/components/course_search_list.dart"
    - "matriculaup_app/lib/ui/components/timetable_grid.dart"
---

# Plan 6.1: Interactive UI & Timetable Grid

<objective>
Build the core interactive scheduling experience. Replace the placeholders on the `HomePage` with a functional `CourseSearchList` component on the left, and a `TimetableGrid` component on the right. Users must be able to add/remove sections and see them reflected on the grid.
</objective>

<context>
Load for context:
- `matriculaup_app/lib/models/course.dart`
- `matriculaup_app/lib/store/schedule_state.dart`
- `matriculaup_app/lib/ui/pages/home_page.dart`
- Reference the Python implementation if needed for UI mapping: `src/matriculaup/ui/components/timetable_grid.py`
</context>

<tasks>

<task type="auto">
  <name>Implement Timetable Grid Component</name>
  <files>matriculaup_app/lib/ui/components/timetable_grid.dart, matriculaup_app/lib/utils/time_utils.dart</files>
  <action>
    Create a `TimetableGrid` widget that reads `selectedSections` from `ScheduleState`.
    Draw a weekly grid from Monday to Saturday, 07:30 to 23:30.
    For each session in `selectedSections`, calculate the vertical offset based on `horaInicio` and height based on `horaFin`.
    Render a positioned container (block) with the course name, session type, and classroom (`aula`).
    Include a delete action (e.g., an 'X' button or right-click context) on the block to call `state.removeSection()`.
  </action>
  <verify>Check component logic for time math and positioning.</verify>
  <done>Grid correctly translates string times into vertical offsets and draws blocks.</done>
</task>

<task type="auto">
  <name>Implement Course Search List</name>
  <files>matriculaup_app/lib/ui/components/course_search_list.dart</files>
  <action>
    Create a `CourseSearchList` widget that reads `allCourses` from `ScheduleState`.
    Add a text input for filtering courses by name or code.
    Display courses in an `ExpansionTile`. When expanded, show the list of `Section`s.
    Each section row should have an "Add" button that calls `state.addSection()`.
  </action>
  <verify>Check component logic for ExpansionTile and filtering.</verify>
  <done>User can search and expand courses to see sections.</done>
</task>

<task type="auto">
  <name>Wire UI Components to HomePage</name>
  <files>matriculaup_app/lib/ui/pages/home_page.dart</files>
  <action>
    In `HomePage`, replace the `ListView.builder` on the left pane with the new `CourseSearchList`.
    Replace the right pane placeholder with the new `TimetableGrid`.
  </action>
  <verify>Run the Flutter app and verify layout.</verify>
  <done>The main layout features both functional components side-by-side.</done>
</task>

</tasks>

<verification>
After tasks, verify:
- [ ] Compiles successfully (`flutter build windows`).
- [ ] Loading JSON populates the search list.
- [ ] Adding a section makes it appear on the grid.
- [ ] Removing a section from the grid clears it.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
