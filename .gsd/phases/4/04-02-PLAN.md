---
phase: 4
plan: 2
wave: 2
depends_on: ["04-01"]
files_modified: ["installer/MatriculaUp.iss", "scripts/build_installer.ps1"]
autonomous: false
user_setup:
  - service: "Inno Setup 6"
    why: "Required to compile the Windows Installer (.iss) into a setup executable."
    download: "https://jrsoftware.org/isdl.php"
must_haves:
  truths:
    - "Installer executable is generated successfully"
    - "Installer creates a Start Menu shortcut"
    - "Application runs after being installed to Program Files (or AppData/Local/Programs)"
  artifacts:
    - "installer/MatriculaUp.iss"
    - "scripts/build_installer.ps1"
---

# Plan 4.2: Windows Installer Distribution

<objective>
Package the PyInstaller `--onedir` output into a professional, standalone Windows installer (`MatriculaUp_v1_Setup.exe`) using Inno Setup.

Purpose: Enable non-technical users to install the application seamlessly with standard Windows conveniences like Start Menu shortcuts and a built-in uninstaller.
Output: An Inno Setup script and a PowerShell wrapper to compile it.
</objective>

<context>
Load for context:
- .gsd/SPEC.md
- .gsd/ROADMAP.md
- dist/MatriculaUp/ (This directory should exist after Plan 4.1)
</context>

<tasks>

<task type="auto">
  <name>Create Inno Setup script</name>
  <files>installer/MatriculaUp.iss</files>
  <action>
    Create the `installer/MatriculaUp.iss` file to compile the `dist/MatriculaUp` folder into a single setup executable.
    It should include:
    - AppName: MatriculaUp
    - AppVersion: 1.0 (or v1)
    - DefaultDirName: `{autopf}\MatriculaUp` (installs to Program Files by default, or Local AppData depending on privileges)
    - OutputBaseFilename: `MatriculaUp_v1_Setup`
    - SetupIconFile: (Optional, keep simple and skip if no icon is available)
    - Compression: lzma
    - A `[Files]` section to recursively include `dist/MatriculaUp/*`
    - A `[Icons]` section to create a Start Menu shortcut pointing to `MatriculaUp.exe`
    AVOID: Including the `input` directory explicitly in the InnoSetup script IF it's already copied into `dist/MatriculaUp` by PyInstaller. Inno Setup just needs to package whatever is inside the `dist/MatriculaUp` directory recursively.
  </action>
  <verify>Check that `installer/MatriculaUp.iss` is created with valid Inno Setup syntax.</verify>
  <done>`MatriculaUp.iss` specifies the correct paths, outputs, and shortcuts.</done>
</task>

<task type="auto">
  <name>Create installer build automation</name>
  <files>scripts/build_installer.ps1</files>
  <action>
    Create a PowerShell script (`scripts/build_installer.ps1`) that invokes the Inno Setup Command Line Compiler (`iscc`).
    The script should check if `iscc` is available (usually at `C:\Program Files (x86)\Inno Setup 6\ISCC.exe` or on PATH) and run `iscc installer/MatriculaUp.iss`.
    If `iscc` is not found, it should print an error asking the user to install Inno Setup 6.
  </action>
  <verify>Run `pwsh scripts/build_installer.ps1` (or `powershell`)</verify>
  <done>The script correctly triggers ISCC or warns the user to install it.</done>
</task>

<task type="checkpoint:human-verify">
  <name>Verify Installer and App</name>
  <files>None</files>
  <action>
    Ask the user to run the generated `MatriculaUp_v1_Setup.exe` installer, install the app, and test running it from the Start Menu.
  </action>
  <verify>User confirms the app installs, starts successfully, and loads the data.</verify>
  <done>App runs smoothly on Windows as an installed program.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] `installer/MatriculaUp.iss` points to `dist/MatriculaUp`.
- [ ] Running `iscc` outputs `MatriculaUp_v1_Setup.exe`.
- [ ] Installing the app results in a working Start Menu shortcut.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
