---
phase: 4
plan: 1
wave: 1
depends_on: []
files_modified: ["src/matriculaup/main.py", "scripts/build_exe.py"]
autonomous: true
must_haves:
  truths:
    - "Application path resolution checks sys.frozen and uses sys._MEIPASS when bundled"
    - "PyInstaller command includes necessary input JSON files"
  artifacts:
    - "scripts/build_exe.py"
---

# Plan 4.1: PyInstaller Configuration

<objective>
Configure path resolution and create a build script to bundle the MatriculaUp application into a standalone Windows executable directory (`--onedir`).

Purpose: Ensure the application runs without a Python interpreter and successfully loads pre-extracted data files on the user's computer.
Output: Updating `main.py` and creating a PyInstaller build script.
</objective>

<context>
Load for context:
- .gsd/SPEC.md
- .gsd/ROADMAP.md
- src/matriculaup/main.py
</context>

<tasks>

<task type="auto">
  <name>Update application path resolution for PyInstaller</name>
  <files>src/matriculaup/main.py</files>
  <action>
    Update the `project_root` logic and JSON loading paths in `main.py` to support PyInstaller.
    When running as a bundled executable (`getattr(sys, 'frozen', False)` is true), the base path should be `sys._MEIPASS`. 
    When running in development, it should remain the project root.
    Ensure `courses_2026-1.json` and `curricula_economia2017.json` are loaded from the `input` directory relative to this base path.
    AVOID: Breaking the development environment path resolution. Test both execution contexts.
  </action>
  <verify>python src/matriculaup/main.py runs successfully in dev mode</verify>
  <done>Paths resolve to `sys._MEIPASS/input/...` when frozen and `project_root/input/...` when not.</done>
</task>

<task type="auto">
  <name>Create executable build script</name>
  <files>scripts/build_exe.py</files>
  <action>
    Create a python script (`scripts/build_exe.py`) that uses the `PyInstaller.__main__.run` API or `subprocess` to build the app.
    It should specify:
    - `--noconfirm`
    - `--onedir`
    - `--windowed` (or `--noconsole`)
    - `--name="MatriculaUp"`
    - `--add-data="input/courses_2026-1.json;input"`
    - `--add-data="input/curricula_economia2017.json;input"`
    - Target script: `src/matriculaup/main.py`
    AVOID: Including unnecessary large packages like `pdfplumber` or `pandas` by accident. The models/UI shouldn't import them, but specify `--exclude-module=pdfplumber` and `--exclude-module=pandas` just to be safe and keep the executable small.
  </action>
  <verify>python scripts/build_exe.py successfully generates `dist/MatriculaUp/MatriculaUp.exe`</verify>
  <done>`dist/MatriculaUp/MatriculaUp.exe` exists and runs without console.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] `main.py` safely handles `sys._MEIPASS`.
- [ ] `build_exe.py` successfully creates the `dist/MatriculaUp` directory.
- [ ] The built `MatriculaUp.exe` opens and displays courses (loads JSON correctly).
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
