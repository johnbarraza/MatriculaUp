---
phase: 8
plan: 3
wave: 3
depends_on: ["Phase 7"]
files_modified: ["matriculaup_app/lib/store/schedule_state.dart", "matriculaup_app/lib/ui/pages/home_page.dart"]
autonomous: false
must_haves:
  truths:
    - "The user can swap between 'Plan A', 'Plan B', and 'Plan C' schedules."
    - "Each schedule plan maintains its own independent list of selected courses."
    - "The UI clearly indicates which plan is currently active."
  artifacts:
    - "matriculaup_app/lib/store/schedule_state.dart"
---

# Plan 8.3: Multiple Contingency Schedules

<objective>
Because university enrollment often involves race conditions for seats, students need fallback plans. We will implement "Multiple Schedules", allowing the user to seamlessly switch between at least 3 distinct schedule plans (Plan A, Plan B, Plan C) using the same UI, without losing progress.
</objective>

<context>
Load for context:
- `matriculaup_app/lib/store/schedule_state.dart`
- `matriculaup_app/lib/ui/pages/home_page.dart`
</context>

<tasks>

<task type="auto">
  <name>Architect Multiple Schedules in State</name>
  <files>matriculaup_app/lib/store/schedule_state.dart</files>
  <action>
    Convert `_selectedSections` from a single List into a Map or List of Lists (e.g., `List<List<CourseSelection>> _schedules = [[], [], []]`).
    Add `int _activeScheduleIndex = 0` (0 = Plan A, 1 = Plan B, 2 = Plan C).
    Update the `selectedSections` getter to return `_schedules[_activeScheduleIndex]`.
    Update `addSection` and `removeSection` to operate on `_schedules[_activeScheduleIndex]`.
    Add a method `void switchSchedule(int index)` that updates `_activeScheduleIndex` and calls `notifyListeners()`.
  </action>
  <verify>Check state variables and getter logic.</verify>
  <done>Under the hood, 3 separate arrays exist and routing logic points to the active one.</done>
</task>

<task type="auto">
  <name>Implement Schedule Switcher UI</name>
  <files>matriculaup_app/lib/ui/pages/home_page.dart</files>
  <action>
    In the AppBar (or above the grid), add a `SegmentedButton` or `DropdownButton` (Plan A, Plan B, Plan C) bound to `state.activeScheduleIndex`.
    When the user clicks "Plan B", it should trigger `state.switchSchedule(1)`. This will automatically re-render `TimetableGrid` and `CourseSearchList` with empty/different selections.
  </action>
  <verify>Check `HomePage` for the new switcher controls and action bindings.</verify>
  <done>User can click tabs to switch their entire workspace context instantly.</done>
</task>

</tasks>

<verification>
After tasks, verify:
- [ ] Adding a course to Plan A does NOT make it appear in Plan B.
- [ ] Switching between A, B, and C instantly repaints the timetable and search list states.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
