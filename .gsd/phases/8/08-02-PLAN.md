---
phase: 8
plan: 2
wave: 2
depends_on: ["Phase 7"]
files_modified: ["matriculaup_app/lib/store/schedule_state.dart", "matriculaup_app/lib/ui/pages/home_page.dart"]
autonomous: false
must_haves:
  truths:
    - "The app tracks and displays the total number of enrolled credits."
    - "Users are blocked from exceeding the global credit limit (default 25)."
    - "Users can edit this global credit limit."
    - "Users can filter the search list to only show courses that fit within a specific selected time block (e.g. 'I want morning classes only')."
  artifacts:
    - "matriculaup_app/lib/store/schedule_state.dart"
---

# Plan 8.2: Free-Time Filtering & Credit Limits

<objective>
Give users absolute control over their schedule parameters. Enforce and allow customization of a credit ceiling (like 25 max credits), and allow users to actively select free-time blocks on the grid to act as a reverse-filter for the search list.
</objective>

<context>
Load for context:
- `matriculaup_app/lib/store/schedule_state.dart`
- `matriculaup_app/lib/ui/pages/home_page.dart`
- `matriculaup_app/lib/ui/components/timetable_grid.dart`
</context>

<tasks>

<task type="auto">
  <name>Implement Credit Tracking & Limits</name>
  <files>matriculaup_app/lib/store/schedule_state.dart, matriculaup_app/lib/ui/pages/home_page.dart</files>
  <action>
    Add `int maxCredits = 25` to `ScheduleState`.
    Add a getter `int get currentCredits` that sums `int.parse(course.creditos)` for all selected sections.
    In `addSection`, throw an exception if `currentCredits + newCourseCredits > maxCredits`.
    Display "Créditos: X / 25" in the AppBar or above the TimetableGrid in `HomePage`. Add an edit icon to change `maxCredits`.
  </action>
  <verify>Check state sum logic and UI binding.</verify>
  <done>User cannot add courses once 25 credits are reached, and can see their running total.</done>
</task>

<task type="manual">
  <name>Design Time-Block Selection (Free-Time Filter)</name>
  <files>matriculaup_app/lib/store/schedule_state.dart, matriculaup_app/lib/ui/components/course_search_list.dart</files>
  <action>
    Design a mechanism to choose preferred hours (e.g., "Exclude afternoons").
    Options: 
    1. A dialog with day/time checkboxes in the search panel.
    2. Interactive clicking on empty grid cells to "block" them out.
    Start with Option 1: Add a "Horario Preferido" filter button near the search bar that allows users to set global rules (e.g., "Nada antes de las 9am", "Nada después de las 6pm"). Update `ScheduleState` to store these bounds and make `hasConflict` respect these artificial "blocked" hours.
  </action>
  <verify>To be determined during manual design review.</verify>
  <done>User can declare certain hours as "off-limits" and the search list will treat courses in those hours as conflicts.</done>
</task>

</tasks>

<verification>
After tasks, verify:
- [ ] Adding 6 courses of 4 credits works (24), but adding the 7th throws the credit limit error.
- [ ] Setting a time preference (e.g. no classes Friday) greys out Friday courses in the search list.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
