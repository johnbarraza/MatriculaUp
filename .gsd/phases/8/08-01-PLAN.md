---
phase: 8
plan: 1
wave: 1
depends_on: ["Phase 7"]
files_modified: ["matriculaup_app/lib/ui/components/course_search_list.dart", "matriculaup_app/lib/store/schedule_state.dart"]
autonomous: false
must_haves:
  truths:
    - "CourseSearchList filters by professor name as well as course code and name."
    - "CourseSearchList has a toggle 'Hide Conflicts' that filters out courses with overlapping schedules."
    - "The Add button is completely disabled for overlapping sections to prevent adding them."
  artifacts:
    - "matriculaup_app/lib/ui/components/course_search_list.dart"
---

# Plan 8.1: Search by Professor & Anti-Collision Filters

<objective>
Enhance the left-side search panel. Users need to search courses by their preferred professors. Additionally, the system should prevent adding overlapping courses rather than just warning about them, and offer a toggle to completely hide courses that would crash with the current schedule.
</objective>

<context>
Load for context:
- `matriculaup_app/lib/ui/components/course_search_list.dart`
- `matriculaup_app/lib/store/schedule_state.dart`
</context>

<tasks>

<task type="auto">
  <name>Block Conflicting Additions</name>
  <files>matriculaup_app/lib/ui/components/course_search_list.dart, matriculaup_app/lib/store/schedule_state.dart</files>
  <action>
    In `CourseSearchList`, modify the `ElevatedButton`'s `onPressed` logic. If `hasConflict` is true, the button must be disabled (pass `null` to `onPressed`).
    Update `ScheduleState.addSection` to double-check and throw an exception if the section conflicts with the existing schedule (as a backend safety measure).
  </action>
  <verify>Check the UI button state and `ScheduleState` validation rules.</verify>
  <done>Users cannot forcibly add a section that flashes red/conflicts.</done>
</task>

<task type="auto">
  <name>Implement Professor Search</name>
  <files>matriculaup_app/lib/ui/components/course_search_list.dart</files>
  <action>
    Update the `filtered` list logic in `CourseSearchList`.
    When matching the `_searchQuery`, iterate through `course.secciones` and their `docentes`. If any `docente` name contains the query (case insensitive), include the course in the results.
  </action>
  <verify>Check the filter condition for `docentes.any(...)`.</verify>
  <done>Searching "Perez" brings up all courses taught by a professor named Perez.</done>
</task>

<task type="auto">
  <name>Implement "Hide Conflicts" Toggle</name>
  <files>matriculaup_app/lib/ui/components/course_search_list.dart</files>
  <action>
    Add a checkbox or switch "Ocultar Cruces" above the search bar.
    Maintain state `_hideConflicts` in `CourseSearchList` (or `ScheduleState`).
    When filtering the list, if `_hideConflicts` is true, remove any *Course* where ALL of its sections return true for `state.conflictsWithSchedule(section)`. (Or simply hide the conflicting sections from the ExpansionTile).
  </action>
  <verify>Check the UI filter logic.</verify>
  <done>User can toggle a switch to only see courses that perfectly fit their remaining free time.</done>
</task>

</tasks>

<verification>
After tasks, verify:
- [ ] Searching by a known professor yields results.
- [ ] Conflicting sections have greyed-out add buttons.
- [ ] Toggling "Hide Conflicts" dynamically removes impossible options from the list.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
