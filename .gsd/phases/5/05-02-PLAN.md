---
phase: 5
plan: 2
wave: 2
depends_on: ["05-01"]
files_modified: ["matriculaup_app/lib/main.dart", "matriculaup_app/lib/store/schedule_state.dart", "matriculaup_app/lib/ui/basic_timetable.dart"]
autonomous: false
must_haves:
  truths:
    - "The user can click 'Load JSON' to select a local `courses_2026-X.json` file via system dialog."
    - "A very basic grid/list renders showing the parsed courses on screen."
  artifacts:
    - "matriculaup_app/lib/main.dart"
    - "matriculaup_app/lib/store/schedule_state.dart"
---

# Plan 5.2: File Picker, Deserialization, & State Management

<objective>
Configure the central state so we can hold the parsed `Course` objects in memory. Add a button via the `file_picker` library that allows the user to manually select the `cursos_*.json` file produced by Python, and render a basic placeholder timetable to confirm data flows correctly to the UI.
</objective>

<context>
Load for context:
- `matriculaup_app/lib/models/course.dart` (created in 05-01)
</context>

<tasks>

<task type="auto">
  <name>Create Global State</name>
  <files>matriculaup_app/lib/store/schedule_state.dart</files>
  <action>
    Create a `ChangeNotifier` (if using Provider) or similar state class that holds a `List<Course> allCourses` and a `List<CourseSelection> selectedSections`.
    This replaces `src/matriculaup/store/state.py` from the Python version.
    Add methods to add/remove selected schedule pieces.
  </action>
  <verify>Check `schedule_state.dart` class syntax and methods.</verify>
  <done>Global state can hold timetable data.</done>
</task>

<task type="auto">
  <name>Implement File Picker & Load JSON</name>
  <files>matriculaup_app/lib/main.dart, matriculaup_app/lib/data/data_loader.dart</files>
  <action>
    Use `file_picker` in a Flutter Widget to let the user pick a `.json` file.
    Use `dart:io` and `dart:convert` to `jsonDecode` the raw string.
    Map the parsed JSON list to `Course.fromJson()` and send the objects into our central `ScheduleState`.
  </action>
  <verify>Run the Flutter app and verify if parsing throws errors when selecting the test JSON.</verify>
  <done>Flutter app can natively read and parse the Python-generated JSON.</done>
</task>

<task type="auto">
  <name>Draw Basic Main Screen</name>
  <files>matriculaup_app/lib/ui/pages/home_page.dart</files>
  <action>
    Create a `HomePage` split into two sections:
    Left Panel (30%): A `ListView` printing the names of the parsed courses. If `allCourses` is empty, show a big "Cargar Archivos JSON (Cursos y Malla)" button.
    Right Panel (70%): A placeholder block (`Container`) where the timetable grid will be drawn in Phase 6.
  </action>
  <verify>Run the app and observe the layout structure.</verify>
  <done>A side-by-side Flutter UI reads the files correctly.</done>
</task>

</tasks>

<verification>
After tasks, verify:
- [ ] Running the app brings up a modern Flutter window.
- [ ] Clicking the "Cargar JSON" button opens Windows File Explorer.
- [ ] Selecting `input/courses_2026-1.json` instantly populates the list on the left with course names.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
